
Collecting usage statistics. To deactivate, set browser.gatherUsageStats to False.


  You can now view your Streamlit app in your browser.

  Network URL: http://192.168.1.152:8501
  External URL: http://123.130.85.125:8501


  A new version of Streamlit is available.

  See what's new at https://discuss.streamlit.io/c/announcements

  Enter the following command to upgrade:
  $ pip install streamlit --upgrade

2023-11-23 21:03:42.219 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 56, in <module>
    chat_box.update_msg(text, element_index=0, streaming=True)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 351, in update_msg
    self.init_session()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 55, in init_session
    self.reset_history(self._chat_name)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 62, in reset_history
    st.session_state[self._session_key][name] = []
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'chat_history'
2023-11-23 21:11:11.252 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/HomePage.py", line 66, in <module>
    name, authentication_status, username = authenticator.login('Login', 'main')
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_authenticator/authenticate.py", line 198, in login
    return st.session_state['name'], st.session_state['authentication_status'], st.session_state['username']
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'name'
2023-11-23 21:12:21.288 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 56, in <module>
    chat_box.update_msg(text, element_index=0, streaming=True)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 351, in update_msg
    self.init_session()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 55, in init_session
    self.reset_history(self._chat_name)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 62, in reset_history
    st.session_state[self._session_key][name] = []
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'chat_history'
2023-11-23 21:21:35.109 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 56, in <module>
    chat_box.update_msg(text, element_index=0, streaming=True)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 351, in update_msg
    self.init_session()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 55, in init_session
    self.reset_history(self._chat_name)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 62, in reset_history
    st.session_state[self._session_key][name] = []
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'chat_history'
2023-11-23 21:29:07.243 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 56, in <module>
    chat_box.update_msg(text, element_index=0, streaming=True)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 351, in update_msg
    self.init_session()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 55, in init_session
    self.reset_history(self._chat_name)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_chatbox/messages.py", line 62, in reset_history
    st.session_state[self._session_key][name] = []
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'chat_history'
2023-11-24 18:38:46.704 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/HomePage.py", line 66, in <module>
    name, authentication_status, username = authenticator.login('Login', 'main')
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_authenticator/authenticate.py", line 198, in login
    return st.session_state['name'], st.session_state['authentication_status'], st.session_state['username']
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'name'

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to False.


  You can now view your Streamlit app in your browser.

  Network URL: http://192.168.1.152:8501
  External URL: http://123.130.85.125:8501

2023-11-27 09:34:35.484 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/HomePage.py", line 66, in <module>
    name, authentication_status, username = authenticator.login('Login', 'main')
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_authenticator/authenticate.py", line 198, in login
    return st.session_state['name'], st.session_state['authentication_status'], st.session_state['username']
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'name'
2023-11-27 09:35:08.644 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connection.py", line 203, in _new_conn
    sock = connection.create_connection(
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connectionpool.py", line 790, in urlopen
    response = self._make_request(
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connectionpool.py", line 496, in _make_request
    conn.request(
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connection.py", line 395, in request
    self.endheaders()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/http/client.py", line 1252, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/http/client.py", line 1012, in _send_output
    self.send(msg)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/http/client.py", line 952, in send
    self.connect()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connection.py", line 243, in connect
    self.sock = self._new_conn()
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connection.py", line 218, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f632511aa30>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/adapters.py", line 486, in send
    resp = conn.urlopen(
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/connectionpool.py", line 844, in urlopen
    retries = retries.increment(
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='127.0.0.1', port=4001): Max retries exceeded with url: /stream (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f632511aa30>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 54, in <module>
    for chunk in llm.stream(query):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/langchain/llms/base.py", line 402, in stream
    raise e
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/langchain/llms/base.py", line 391, in stream
    for chunk in self._stream(
  File "/home/wangquanjun/project/websites/starchain/server/llm/chatglm_extension.py", line 112, in _stream
    response = requests.post(self.endpoint_url+"/stream", stream=True, headers=headers, json=payload)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/api.py", line 115, in post
    return request("post", url, data=data, json=json, **kwargs)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='127.0.0.1', port=4001): Max retries exceeded with url: /stream (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f632511aa30>: Failed to establish a new connection: [Errno 111] Connection refused'))

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to False.


  You can now view your Streamlit app in your browser.

  Network URL: http://192.168.1.152:8501
  External URL: http://123.130.85.125:8501


Collecting usage statistics. To deactivate, set browser.gatherUsageStats to False.


  You can now view your Streamlit app in your browser.

  Network URL: http://192.168.1.152:8501
  External URL: http://123.130.85.125:8501

2023-11-29 21:17:40.227 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/pages/QuestionAnswerSystem.py", line 40, in <module>
    llm = ChatGLM()
  File "/home/wangquanjun/project/websites/starchain/llm_server/chatglm/chatglm_extension.py", line 51, in __init__
    self.endpoint_url = self.endpoint_url.format(host, port)
AttributeError: 'ChatGLM' object has no attribute 'endpoint_url'
2023-11-30 10:08:20.570 Uncaught app exception
Traceback (most recent call last):
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 541, in _run_script
    exec(code, module.__dict__)
  File "/home/wangquanjun/project/websites/starchain/HomePage.py", line 66, in <module>
    name, authentication_status, username = authenticator.login('Login', 'main')
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit_authenticator/authenticate.py", line 198, in login
    return st.session_state['name'], st.session_state['authentication_status'], st.session_state['username']
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/session_state_proxy.py", line 90, in __getitem__
    return get_session_state()[key]
  File "/opt/anaconda3/envs/chatglm26b/lib/python3.9/site-packages/streamlit/runtime/state/safe_session_state.py", line 111, in __getitem__
    raise KeyError(key)
KeyError: 'name'
